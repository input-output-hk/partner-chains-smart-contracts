# Build/test/run
* `nix build` or `spago build`
* `make test` for tests
* `make dev` will start webpack dev server at localhost:4008
* `make build` will output webpack-bundled example module to dist
* Note `BROWSER_RUNTIME` env variable should be set to 1 to build project properly for browser (for node environments leave unset or set 0)

# Running ctl contracts (requires a nami wallet (or gero depending on ContractConfig) , which both require chromium-based browsers)
* Need an active wallet, running on testnet (toggle a setting in nami)
* set collateral, which nami reserves apart from other wallet utxos

# Adding PS/JS dependencies
## Purescript
Unfortunately, we rely on spago2nix, which requires autogenerated Nix code (spago-packages.nix). This means that it is possible for our declared Purescript dependencies to drift from the autogen Nix code we import in to build Purescript derivations. If you add either a Purescript dependency, make sure to run `spago2nix generate` **from within the Nix shell** to update the autogen code from spago2nix. Do not edit spago-packages.nix by hand, or the build will likely break.

## JS
If you add a dependency to `package.json`, make sure to update the lockfile with `npm i --package-lock-only` before entering a new dev shell, otherwise the shellHook will fail. You'll need to remove the any existing node_modules to do this (for some reason npm will still try to write to the node_modules, but will fail because they're symlinked to the Nix store).
After updating your `package-lock.json` with the previous `npm` invocation, remember to reload
your nix shell.

# Nix
Upgrading ctl etc.. [read their docs](https://github.com/Plutonomicon/cardano-transaction-lib/blob/develop/doc/ctl-as-dependency.md#upgrading-ctl)

# Notes
* All scripts must be explicitly passed to CTL. unlike plutus , off-on chain must share scripts in serialized format: easiest is using Contract.TextEnvelope.textEnvelope with the JS FFI

* Applying arguments to parameterized scripts requires a weird hack wrapping Data arguments (unsafeFromBuiltinData)
